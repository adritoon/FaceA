<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mejorador de Rostros - GlowFace</title>
  <style>
    /* ... (estilos existentes sin cambios, mantenlos como los tienes) ... */

    .loading-gif {
      display: none;
      text-align: center;
      margin-top: 20px;
    }

    .toggle-on {
      background-color: #28a745;
    }

    .toggle-off {
      background-color: #dc3545;
    }
  </style>

  <!-- Google Analytics, favicon, ads, OpenGraph... (ya incluidos correctamente) -->

</head>
<body>
  <main>
    <div class="lang-switch">
      <a href="/en"><img src="{{ url_for('static', filename='en.png') }}" alt="English" style="width: 24px; height: 16px;"></a>
    </div>

    <button class="theme-toggle" onclick="toggleTheme()">üåó Modo oscuro</button>

    <h1>Mejora Facial con IA</h1>

    <div class="container">
      <div class="image-panel">
        <img id="resultImg" src="{{ output_image or '' }}" style="display: {{ output_image and 'block' or 'none' }};">
        <div class="loading-gif" id="loadingGif">
          <img src="{{ url_for('static', filename='loading.gif') }}" alt="Cargando..." style="max-width: 100px;">
          <p>Procesando imagen...</p>
        </div>
      </div>

      <div class="form-panel" id="formPanel">
        <form method="POST" enctype="multipart/form-data" onsubmit="handleSubmit(event)">
          <input type="file" name="image" accept="image/*" required onchange="previewImage(event)">

          <label>
            <input type="checkbox" name="mejorar_fondo" value="1">
            Mejorar tambi√©n el fondo (m√°s lento)
          </label>
          <label>
            <input type="checkbox" name="modo_dibujo" value="1">
            Mejorar ilustraciones
          </label>

          <div class="select-row">
            <label for="escala">Escala de mejora:</label>
            <select name="escala" id="escala">
              <option value="1">1x (sin ampliar)</option>
              <option value="2" selected>2x (recomendado)</option>
              <option value="4">4x (m√°xima calidad)</option>
            </select>
          </div>

          <button type="submit">
            Mejorar imagen
          </button>
        </form>
      </div>

      {% if output_image and original_image %}
      <div class="controls">
        <button id="toggleBtn" onclick="toggleImage()" class="toggle-on">Ver Original</button>
        <a href="{{ output_image }}" download>
          ‚¨áÔ∏è Descargar imagen mejorada
        </a>
      </div>
      {% endif %}
    </div>

    <script>
      let showingOriginal = false;

      function toggleImage() {
        const img = document.getElementById("resultImg");
        const btn = document.getElementById("toggleBtn");
        const originalSrc = "{{ original_image or '' }}";
        const enhancedSrc = "{{ output_image or '' }}";

        if (!originalSrc || !enhancedSrc) return;

        if (showingOriginal) {
          img.src = enhancedSrc;
          btn.innerText = "Ver Original";
          btn.classList.remove("toggle-off");
          btn.classList.add("toggle-on");
        } else {
          img.src = originalSrc;
          btn.innerText = "Ver Mejorada";
          btn.classList.remove("toggle-on");
          btn.classList.add("toggle-off");
        }
        showingOriginal = !showingOriginal;
      }

      function toggleTheme() {
        const body = document.body;
        const isDark = body.classList.toggle("dark");
        localStorage.setItem("darkMode", isDark ? "1" : "0");
      }

      window.onload = () => {
        if (localStorage.getItem("darkMode") === "1") {
          document.body.classList.add("dark");
        }
      };

      function previewImage(event) {
        const img = document.getElementById("resultImg");
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = e => {
            img.src = e.target.result;
            img.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      }

      function handleSubmit(event) {
        document.getElementById("formPanel").style.display = "none";
        document.getElementById("loadingGif").style.display = "block";
      }
    </script>
  </main>

  <footer id="footer">
    <a href="/es/about">Acerca de</a> |
    <a href="/es/how-to-use">C√≥mo usar</a> |
    <a href="/es/privacy">Pol√≠tica de privacidad</a> |
    <a href="/es/faq">Preguntas frecuentes</a>
  </footer>
</body>
</html>
